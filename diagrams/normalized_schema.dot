digraph "Normalized Schema (3NF)" {
    rankdir=LR;
    node [shape=plaintext, fontsize=10];
    edge [fontsize=8];
    clientes [label=<<table border="1" cellborder="0" cellspacing="0"><tr><td bgcolor="lightblue"><b>clientes</b></td></tr><tr><td align="left"><b>cliente_id SERIAL PRIMARY KEY</b></td></tr><tr><td align="left">nombre VARCHAR(100) NOT NULL</td></tr><tr><td align="left">email VARCHAR(100) UNIQUE NOT NULL</td></tr><tr><td align="left">telefono VARCHAR(20)</td></tr><tr><td align="left">fecha_registro TIMESTAMP DEFAULT CURRENT_TIMESTAMP</td></tr></table>>];
    direcciones [label=<<table border="1" cellborder="0" cellspacing="0"><tr><td bgcolor="lightblue"><b>direcciones</b></td></tr><tr><td align="left"><b>direccion_id SERIAL PRIMARY KEY</b></td></tr><tr><td align="left"><i>cliente_id INT NOT NULL REFERENCES clientes(cliente_id) ON DELETE CASCADE</i></td></tr><tr><td align="left">calle TEXT NOT NULL</td></tr><tr><td align="left">ciudad VARCHAR(50) NOT NULL</td></tr><tr><td align="left">codigo_postal VARCHAR(10)</td></tr><tr><td align="left">es_principal BOOLEAN DEFAULT false</td></tr><tr><td align="left">fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP</td></tr></table>>];
    categorias [label=<<table border="1" cellborder="0" cellspacing="0"><tr><td bgcolor="lightblue"><b>categorias</b></td></tr><tr><td align="left"><b>categoria_id SERIAL PRIMARY KEY</b></td></tr><tr><td align="left">nombre VARCHAR(100) UNIQUE NOT NULL</td></tr><tr><td align="left">descripcion TEXT</td></tr></table>>];
    productos [label=<<table border="1" cellborder="0" cellspacing="0"><tr><td bgcolor="lightblue"><b>productos</b></td></tr><tr><td align="left"><b>producto_id SERIAL PRIMARY KEY</b></td></tr><tr><td align="left">nombre VARCHAR(200) NOT NULL</td></tr><tr><td align="left">descripcion TEXT</td></tr><tr><td align="left">precio DECIMAL(10,2) NOT NULL CHECK (precio &gt; 0)</td></tr><tr><td align="left">stock INT DEFAULT 0 CHECK (stock &gt;= 0)</td></tr><tr><td align="left"><i>categoria_id INT REFERENCES categorias(categoria_id)</i></td></tr><tr><td align="left">fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP</td></tr><tr><td align="left">activo BOOLEAN DEFAULT true</td></tr></table>>];
    pedidos [label=<<table border="1" cellborder="0" cellspacing="0"><tr><td bgcolor="lightblue"><b>pedidos</b></td></tr><tr><td align="left"><b>pedido_id SERIAL PRIMARY KEY</b></td></tr><tr><td align="left"><i>cliente_id INT NOT NULL REFERENCES clientes(cliente_id)</i></td></tr><tr><td align="left"><i>direccion_entrega_id INT REFERENCES direcciones(direccion_id)</i></td></tr><tr><td align="left">fecha_pedido TIMESTAMP DEFAULT CURRENT_TIMESTAMP</td></tr><tr><td align="left">total DECIMAL(10,2) NOT NULL CHECK (total &gt;= 0)</td></tr><tr><td align="left">estado VARCHAR(20) DEFAULT 'pendiente'</td></tr><tr><td align="left">CHECK (estado IN ('pendiente', 'procesando', 'enviado', 'entregado', 'cancelado'))</td></tr></table>>];
    items_pedido [label=<<table border="1" cellborder="0" cellspacing="0"><tr><td bgcolor="lightblue"><b>items_pedido</b></td></tr><tr><td align="left"><b>item_id SERIAL PRIMARY KEY</b></td></tr><tr><td align="left"><i>pedido_id INT NOT NULL REFERENCES pedidos(pedido_id) ON DELETE CASCADE</i></td></tr><tr><td align="left"><i>producto_id INT NOT NULL REFERENCES productos(producto_id)</i></td></tr><tr><td align="left">cantidad INT NOT NULL CHECK (cantidad &gt; 0)</td></tr><tr><td align="left">precio_unitario DECIMAL(10,2) NOT NULL CHECK (precio_unitario &gt;= 0)</td></tr><tr><td align="left">subtotal DECIMAL(10,2) GENERATED ALWAYS AS (cantidad * precio_unitario) STORED</td></tr></table>>];
    clientes -> direcciones [label="cliente_id->cliente_id"];
    categorias -> productos [label="categoria_id->categoria_id"];
    clientes -> pedidos [label="cliente_id->cliente_id"];
    direcciones -> pedidos [label="direccion_entrega_id->direccion_id"];
    pedidos -> items_pedido [label="pedido_id->pedido_id"];
    productos -> items_pedido [label="producto_id->producto_id"];
}